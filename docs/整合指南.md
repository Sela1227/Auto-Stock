# 🛠️ SELA 設定頁面 UI - 整合指南

> 版本: 1.0.0  
> 更新日期: 2026-01-12

---

## 📦 檔案清單

```
settings-ui-update/
├── static/
│   ├── css/
│   │   └── settings.css      # 設定頁面樣式
│   ├── js/
│   │   └── settings.js       # 設定頁面邏輯
│   └── settings-section.html # HTML 片段
└── 整合指南.md                # 本文件
```

---

## 🚀 快速整合步驟

### 步驟 1: 複製靜態資源

將 `static/css/` 和 `static/js/` 資料夾複製到專案的 `static/` 目錄下：

```bash
cp -r static/css static/js /path/to/your/project/static/
```

### 步驟 2: 在 dashboard.html 引入資源

在 `<head>` 區塊內加入 CSS：

```html
<!-- 設定頁面樣式 -->
<link rel="stylesheet" href="/static/css/settings.css">
```

在 `</body>` 標籤之前加入 JavaScript：

```html
<!-- 設定頁面腳本 -->
<script src="/static/js/settings.js"></script>
```

### 步驟 3: 加入 HTML 結構

將 `settings-section.html` 的內容複製到 dashboard.html 中，放在其他 section 之後：

```html
<!-- 現有的 sections -->
<section id="section-dashboard" class="section">...</section>
<section id="section-watchlist" class="section hidden">...</section>
<section id="section-compare" class="section hidden">...</section>

<!-- 新增：設定頁面 section -->
<section id="section-settings" class="section hidden">
    <!-- 從 settings-section.html 複製內容 -->
</section>
```

### 步驟 4: 新增導航連結

#### 桌面版導航列

在 `<nav>` 區塊內加入設定連結：

```html
<a onclick="showSection('settings', event)" 
   class="nav-link flex items-center px-4 py-2 text-gray-600 hover:bg-blue-50 hover:text-gray-700 rounded-lg transition-colors cursor-pointer">
    <i class="fas fa-cog mr-2"></i>
    設定
</a>
```

#### 手機版底部導航

在底部導航列加入：

```html
<button onclick="showSection('settings', event)" 
        class="nav-tab flex flex-col items-center py-2 px-3 text-gray-500 hover:text-orange-500 transition-colors">
    <i class="fas fa-cog text-lg"></i>
    <span class="text-xs mt-1">設定</span>
</button>
```

### 步驟 5: 更新 showSection 函數

在現有的 `showSection` 函數中加入設定頁面的初始化邏輯：

```javascript
function showSection(name, evt) {
    // ... 原有的 section 切換邏輯 ...
    
    // 切換到設定頁時載入設定
    if (name === 'settings') {
        if (typeof initSettingsPage === 'function') {
            initSettingsPage();
        }
    }
}
```

### 步驟 6: 更新用戶資訊顯示

在登入成功後，更新設定頁面的用戶資訊：

```javascript
function updateSettingsUserInfo() {
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    
    const avatar = document.getElementById('settings-user-avatar');
    const name = document.getElementById('settings-user-name');
    const level = document.getElementById('settings-user-level');
    
    if (avatar && user.avatar_url) {
        avatar.src = user.avatar_url;
    }
    if (name) {
        name.textContent = user.display_name || '用戶';
    }
    if (level) {
        level.textContent = user.is_admin ? '管理員' : '免費會員';
    }
}

// 在 checkAuth() 成功後調用
updateSettingsUserInfo();
```

---

## 🔧 API 依賴

設定頁面需要以下 API 端點（應已存在於後端）：

| 端點 | 方法 | 說明 |
|------|------|------|
| `/api/settings/indicators` | GET | 取得指標顯示設定 |
| `/api/settings/indicators` | PUT | 更新指標顯示設定 |
| `/api/settings/alerts` | GET | 取得通知設定 |
| `/api/settings/alerts` | PUT | 更新通知設定 |
| `/api/settings/params` | GET | 取得參數設定 |
| `/api/settings/params` | PUT | 更新參數設定 |
| `/api/settings/template/{name}` | POST | 套用預設模板 |

---

## 🎨 自訂樣式

### 修改主題色

在 `settings.css` 中搜尋並替換以下顏色：

- **主色調** (橙色): `#f97316`, `#ea580c`
- **活動狀態** (藍色): `#3b82f6`, `#2563eb`
- **成功狀態** (綠色): `#16a34a`
- **錯誤狀態** (紅色): `#dc2626`

### 自訂開關樣式

修改 `.toggle-switch` 和 `.toggle-dot` 類別。

---

## ⚠️ 注意事項

1. **apiRequest 函數依賴**  
   `settings.js` 依賴 dashboard.html 中的 `apiRequest()` 函數，確保該函數可用。

2. **Token 認證**  
   所有 API 請求需要帶有 Authorization header，由 `apiRequest()` 處理。

3. **離開確認**  
   若需要在離開設定頁面時提示未儲存變更，可在 `showSection` 中調用：
   ```javascript
   if (!checkUnsavedChanges()) return;
   ```

4. **響應式設計**  
   CSS 已包含手機版適配，無需額外處理。

---

## 🐛 疑難排解

### 問題：設定無法載入

1. 確認 API 端點可用
2. 檢查 Console 是否有錯誤
3. 確認 Token 有效

### 問題：樣式不正確

1. 確認 CSS 檔案已正確載入
2. 清除瀏覽器快取 (Ctrl+Shift+R)
3. 檢查是否有 CSS 衝突

### 問題：JavaScript 錯誤

1. 確認 JS 檔案載入順序正確（settings.js 應在 dashboard.html 的主腳本之後）
2. 確認 `apiRequest` 函數存在

---

## 📋 檢查清單

- [ ] CSS 檔案已複製到 `/static/css/`
- [ ] JS 檔案已複製到 `/static/js/`
- [ ] dashboard.html 已引入 CSS
- [ ] dashboard.html 已引入 JS
- [ ] HTML section 已加入
- [ ] 導航連結已加入（桌面版 + 手機版）
- [ ] showSection 函數已更新
- [ ] 測試：可以切換到設定頁面
- [ ] 測試：設定可以正常載入
- [ ] 測試：設定可以正常儲存
- [ ] 測試：模板可以正常套用

---

## 📞 技術支援

如有問題，請提供：
1. 瀏覽器 Console 錯誤訊息
2. Network 面板的 API 請求結果
3. 操作步驟說明

---

> ✅ 整合完成後，用戶即可透過設定頁面自訂指標顯示和通知偏好！
