# 📋 SELA 待辦追蹤

> 版本: 3.0  
> 最後更新: 2026-01-17  
> 依據: Bundle 程式碼實際檢視結果

---

## 當前狀態總覽

### ✅ 已完成功能

| 功能 | 說明 | 完成狀態 |
|------|------|----------|
| **市場感知快取** | 非交易時段使用本地快取，效能提升 10-40x | ✅ `price_cache_service.py` |
| **圖表功能修復** | 時間範圍按鈕、MA 均線、圖例點擊 | ✅ `chart-fix-final.js` |
| **訂閱精選（完整）** | 後端 API + 前端 Tab + 訂閱/取消 | ✅ `subscription.py` + `subscription.js` |
| **追蹤清單匯出匯入** | JSON/CSV 匯出匯入 | ✅ `watchlist.py` `/export` `/import` |
| **持股交易匯出匯入** | JSON/CSV 匯出匯入 | ✅ `portfolio-export-import.js` + `portfolio.py` |
| **stock_info 種子表** | 30+ 筆熱門股票預建資料 | ✅ `models/stock_info.py` + `routers/stock_info.py` |
| **成交量圖表** | 漲跌顏色柱狀圖 + 20日均量線 | ✅ `renderVolumeChart()` |
| **熱門追蹤統計** | `/api/watchlist/popular` | ✅ `watchlist.py` |
| **index_service 模組** | 四大指數更新服務 | ✅ `services/index_service.py` |
| **投資組合功能** | 台美股分開管理、交易記錄 | ✅ 完整實作 |
| **匯率自動更新** | 每天 3 次更新 USD/TWD | ✅ 排程任務 |
| **追蹤清單排序** | 自訂/代碼/漲幅/MA20 排序 | ✅ 完整實作 |
| **到價提醒變色** | 達標時卡片變色提示 | ✅ 完整實作 |
| **MA 距離計算** | dist_ma20/50/200 百分比 | ✅ 後端已實作 |
| **目標價方向功能** | 高於/低於提醒 + 即時更新 | ✅ `SELA_目標價功能修復記錄.md` |
| **MA 強化分析** | 交叉天數/支撐壓力/多空排列 | ✅ `SELA_MA強化分析_開發記錄.md` |

---

## 🔴 P1 優先級（待完成）

### 1. 追蹤清單載入效能診斷
- **狀態**: 待測量
- **描述**: 確認載入時間是否仍有問題
- **建議方案**: 
  - 加入前端載入時間 log
  - 確認市場感知快取是否正確運作

### 2. 券商功能部署
- **狀態**: 開發完成，待部署
- **描述**: 交易紀錄關聯券商帳戶
- **文件**: `SELA_券商功能部署指南.md`
- **涉及檔案**: 
  - `app/models/broker.py` - 券商資料模型
  - `app/routers/broker.py` - 券商 API
  - `static/js/broker.js` - 券商管理前端

---

## 🟡 P2 優先級（規劃中）

### 3. 訂閱精選自動更新驗證
- **描述**: 確認排程是否正確執行
- **現況**: 有手動觸發按鈕可用
- **待驗證**: APScheduler 排程任務

### 4. 前端效能優化
- **描述**: 減少重複渲染、懶載入
- **涉及**: dashboard.html, watchlist.js

---

## 🟢 P3 優先級（技術債務）

### 程式碼優化建議

| 檔案 | 行數 | 建議 |
|------|------|------|
| dashboard.html | 1908 | 考慮拆分為模板組件 |
| indicator_service.py | 830 | 拆分為獨立指標模組 |
| watchlist.js | 811 | 考慮拆分 |

### 其他技術債務

- [ ] JS 檔案整合（目前用 defineProperty 鎖定）
- [ ] 台股名稱對照表移至獨立 JSON
- [ ] API 錯誤處理統一化
- [ ] 增加單元測試

---

## ⚠️ 已知問題

| 問題 | 狀態 | 說明 |
|------|------|------|
| Railway 部署偶爾卡住 | 間歇性 | Railway 平台問題，取消重新部署即可 |
| 訂閱精選排程 | 待驗證 | 需確認是否正確執行 |

---

## 下次開發建議順序

```
1. 追蹤清單載入效能診斷
   ↓
2. 券商功能部署
   ↓
3. 訂閱精選排程驗證
   ↓
4. 前端效能優化
```

---

## Memory 同步待辦清單

以下待辦同步至 Claude Memory：

> SELA 待辦: P1: (1)追蹤清單載入效能診斷 P2: (2)訂閱排程驗證 (3)前端效能優化 | 已完成:匯出匯入/stock_info種子表/成交量圖表/MA強化分析/熱門追蹤/訂閱Tab/目標價方向/券商功能(待部署)

---

## 相關文件

| 文件 | 說明 |
|------|------|
| SELA_系統規格書.md | 架構、資料庫、API 設計 |
| SELA_開發指南.md | Bug 修復、前端優化 |
| SELA_部署指南.md | Railway 部署、遷移 |
| SELA_更新日誌.md | 版本變更紀錄 |
| SELA_目標價功能修復記錄.md | 目標價高於/低於功能開發記錄 |
| SELA_券商功能部署指南.md | 券商功能部署步驟 |
| SELA_MA強化分析_開發記錄.md | MA 強化分析開發記錄 |

---

## 更新記錄

| 日期 | 更新內容 |
|------|----------|
| 2026-01-17 | v3.0 - 重新檢視 bundle，確認多項功能已完成 |
| 2026-01-17 | 新增 MA 強化分析、目標價方向功能、券商功能 |
| 2026-01-17 | 確認匯出匯入、stock_info、成交量圖表、熱門追蹤已完成 |
| 2026-01-17 | 確認訂閱精選前端 Tab 已完成 |
| 2026-01-15 | 完成股票詳情修復、訂閱功能修復 |
