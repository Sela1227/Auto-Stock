# 🔧 台股名稱編碼修復

> 文件編號: 20260112-002  
> 更新日期: 2026-01-12  
> 類型: Bug 修復  
> 優先級: **緊急**

---

## 🔴 問題根源（重要！）

**Bundle 文件中的 `TAIWAN_STOCK_NAMES` 字典已經是亂碼！**

這不是 compare_service.py 的問題，而是原始檔案中的中文被破壞了：

```python
# yahoo_finance.py 中現在的狀態（已損壞）:
"2330": "Ã¥ÂÂ°Ã§Â©ÂÃ©â€ºÂ»",  # 應該是「台積電」

# price_cache_service.py 中現在的狀態（已損壞）:
"0050": "å…ƒå¤§å°ç£50",  # 應該是「元大台灣50」
```

**原因：** 在某次檔案處理時，UTF-8 編碼被破壞了。

---

## 📁 需要修復的檔案

| 檔案 | 位置 | 說明 |
|------|------|------|
| `yahoo_finance.py` | `app/data_sources/` | 主要資料來源，**必須修復** |
| `price_cache_service.py` | `app/services/` | 快取服務，也需要修復 |

---

## 🚀 修復步驟

### 步驟 1: 修復 yahoo_finance.py

找到 `app/data_sources/yahoo_finance.py` 中的 `TAIWAN_STOCK_NAMES = {...}`

**整個替換為：**

```python
TAIWAN_STOCK_NAMES = {
    # 權值股
    "2330": "台積電",
    "2317": "鴻海",
    "2454": "聯發科",
    "2308": "台達電",
    "2412": "中華電",
    "2303": "聯電",
    "2002": "中鋼",
    "1301": "台塑",
    "1303": "南亞",
    "1326": "台化",
    "6505": "台塑化",
    "1101": "台泥",
    "1102": "亞泥",
    # 金融股
    "2881": "富邦金",
    "2882": "國泰金",
    "2884": "玉山金",
    "2886": "兆豐金",
    "2891": "中信金",
    "2892": "第一金",
    "2880": "華南金",
    "2883": "開發金",
    "2885": "元大金",
    "2887": "台新金",
    "2888": "新光金",
    "2890": "永豐金",
    "5880": "合庫金",
    # 電子股
    "2912": "統一超",
    "2357": "華碩",
    "2382": "廣達",
    "2395": "研華",
    "3008": "大立光",
    "3711": "日月光投控",
    "2345": "智邦",
    "2379": "瑞昱",
    "2327": "國巨",
    "3034": "聯詠",
    "2301": "光寶科",
    "2408": "南亞科",
    "2474": "可成",
    "3045": "台灣大",
    "4904": "遠傳",
    "3231": "緯創",
    "2356": "英業達",
    "2353": "宏碁",
    "2324": "仁寶",
    "2377": "微星",
    "2376": "技嘉",
    "4938": "和碩",
    "2409": "友達",
    "3481": "群創",
    "6669": "緯穎",
    "3037": "欣興",
    "2344": "華邦電",
    "2337": "旺宏",
    "3443": "創意",
    "6488": "環球晶",
    "5269": "祥碩",
    "6415": "矽力-KY",
    "3661": "世芯-KY",
    "2603": "長榮",
    "2609": "陽明",
    "2615": "萬海",
    "2618": "長榮航",
    "2610": "華航",
    "2633": "台灣高鐵",
    "9910": "豐泰",
    "9921": "巨大",
    "1216": "統一",
    "2207": "和泰車",
    "5871": "中租-KY",
    "9941": "裕融",
    "5876": "上海商銀",
    "6239": "力成",
    "8046": "南電",
    "3017": "奇鋐",
    "6176": "瑞儀",
    "6285": "啟碁",
    "2492": "華新科",
    "3533": "嘉澤",
    "6531": "愛普",
    "3665": "貿聯-KY",
    "8454": "富邦媒",
    "2383": "台光電",
    "6446": "藥華藥",
    "6547": "高端疫苗",
    # ETF
    "0050": "元大台灣50",
    "0051": "元大中型100",
    "0052": "富邦科技",
    "0053": "元大電子",
    "0055": "元大MSCI金融",
    "0056": "元大高股息",
    "006208": "富邦台50",
    "00646": "元大S&P500",
    "00662": "富邦NASDAQ",
    "00713": "元大台灣高息低波",
    "00850": "元大臺灣ESG永續",
    "00878": "國泰永續高股息",
    "00881": "國泰台灣5G+",
    "00891": "中信關鍵半導體",
    "00892": "富邦台灣半導體",
    "00893": "國泰智能電動車",
    "00895": "富邦未來車",
    "00900": "富邦特選高股息30",
    "00919": "群益台灣精選高息",
    "00929": "復華台灣科技優息",
    "00939": "統一台灣高息優選",
    "00940": "元大台灣價值高息",
}
```

### 步驟 2: 同樣修復 price_cache_service.py

找到 `app/services/price_cache_service.py` 中的 `TAIWAN_STOCK_NAMES = {...}`，用相同的字典替換。

### 步驟 3: 確保檔案使用 UTF-8 編碼儲存

儲存時確認編輯器使用 **UTF-8 without BOM** 編碼。

---

## ✅ 驗證

1. 開啟比較頁面
2. 選擇台股（如 2330.TW）
3. 確認名稱顯示為「台積電」而非亂碼

---

## ⚠️ 預防措施

1. 使用 Git 時設定：`git config --global core.quotepath false`
2. 編輯器設定為 UTF-8
3. 避免用 Windows 記事本編輯 Python 檔案
